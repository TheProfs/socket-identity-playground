<!DOCTYPE html>
<html>
  <head>
    <title>socket-identity-playground UI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js" integrity="sha512-7IDZ+mHVoc7nSziUi72L5rGojJDtveVWHOjb+Eu8QSnguy5FitNnFyEoLoL3v1u18DNm4E30elDfkhZvVADw6Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
      * {
        font-family: sans-serif;
        color: #444;
      }

      label {
        font-weight: bold;
        color: #222;
      }
    </style>
  </head>

  <body>
    <h1>Results</h1>
    <p> I am in room: <label id="room-lbl"> </label></p>
    <p> I am id_user: <label id="id-user-lbl"> </label></p>
    <p> I am socket: <label id="socket-lbl"> </label></p>
    <p> I am connected to node: <label id="proc-lbl"> </label></p>

    <h2> Received events </h2>
    <hr>
    <ul id="event-container"></ul>
  </body>

  <script>
    'use strict'

    const params = Object.fromEntries((new URLSearchParams(window.location.search)).entries())
    const container = document.querySelector('#event-container')

    const id_user = params.id_user || 'bar'
    const room = window.location.pathname.split('/')[1].trim()
    const socket = io('http://localhost:5009', {
      reconnection: true,
      reconnectionAttempts: 5,
      transports: ['websocket'],
      query: `room=${room}&id_user=${id_user}`
    })

    socket.on('connect', e => {
      document.title = `room: ${room}, id_user: ${id_user}`
      document.querySelector('#id-user-lbl').innerHTML = id_user
      document.querySelector('#room-lbl').innerHTML = room
      document.querySelector('#socket-lbl').innerHTML = socket.id
    })

    socket.on('handshake', e => {
      document.querySelector('#proc-lbl').innerHTML = e.procid
    })

    socket.on('paper-event', e => {
      console.log('received event')

      const li = document.createElement('li')

      li.appendChild(document.createTextNode(JSON.stringify(e)))

      container.appendChild(li)
    })

    setInterval(() => {
      console.log('emitted event')
      socket.emit('paper-event', { socket: socket.id, data: 'foo' })
    }, 2500)
  </script>
</html>
